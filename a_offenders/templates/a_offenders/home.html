{% extends "a_incidents/base.html" %}
{% block content %}
<section class="bg-white dark:bg-gray-900 py-8 md:py-12">
  <div class="mx-auto max-w-screen-lg px-4">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <h1 class="text-3xl font-semibold text-gray-900 dark:text-white">All Offenders</h1>

      {% if request.user.is_authenticated %}
        <a href="{% url 'create-offender' %}"
           class="inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700">
          Create Offender
        </a>
      {% endif %}
    </div>

    <!-- Search -->
    <form method="get" class="mt-4">
      <label for="q" class="sr-only">Search</label>
      <div class="relative">
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
          <svg class="h-4 w-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none">
            <path stroke="currentColor" stroke-width="2" stroke-linecap="round"
                  d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
          </svg>
        </div>
        <input id="q" name="search" value="{{ search_query }}"
               placeholder="Search name / contact / notes"
               class="h-[42px] w-full rounded-lg border border-gray-300 bg-gray-50 pl-9 pr-3 text-sm text-gray-900
                      focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100" />
      </div>
    </form>

    <!-- Grid -->
    <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {% for offender in offenders %}
        <div class="rounded-lg border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
          <div class="flex flex-col items-center">
            {% if offender.photo %}
              <img class="h-24 w-24 rounded-full object-cover border" src="{{ offender.photo.url }}" alt="{{ offender.name }}">
            {% else %}
              <div class="h-24 w-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                <svg class="h-10 w-10 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm0 2c-3.2 0-8 1.6-8 4v2h16v-2c0-2.4-4.8-4-8-4Z"/>
                </svg>
              </div>
            {% endif %}

            <h2 class="mt-3 text-lg font-medium text-gray-900 dark:text-white text-center">{{ offender.name }}</h2>

            <div class="mt-2 flex flex-wrap justify-center gap-2">
              {% if offender.is_currently_banned %}
                <span class="rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">Banned</span>
              {% else %}
                <span class="rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">Not Banned</span>
              {% endif %}
              {% if offender.total_warnings %}
                <span class="rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">
                  {{ offender.total_warnings }} Warning{{ offender.total_warnings|pluralize }}
                </span>
              {% endif %}
            </div>

            <div class="mt-3 text-center text-sm text-gray-600 dark:text-gray-300 space-y-1">
              {% if offender.occupation %}<p>{{ offender.occupation }}</p>{% endif %}
              {% if offender.age %}<p>Age: {{ offender.age }}</p>{% endif %}
              {% if offender.sex %}<p>Sex: {{ offender.get_sex_display }}</p>{% endif %}
            </div>

            <div class="mt-5 flex gap-2">
              <a href="{% url 'offender-detail' offender.id %}"
                 class="rounded-lg border px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-100
                        dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700">
                View Details
              </a>
              <a href="{% url 'update-offender' offender.id %}"
                 class="rounded-lg border px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-100
                        dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700">
                Update
              </a>
              <form action="{% url 'delete-offender' offender.id %}" method="post"
                    onsubmit="return confirm('Delete this offender?');">
                {% csrf_token %}
                <button class="rounded-lg border px-4 py-2 text-sm font-medium text-red-600
                                hover:bg-red-50 dark:border-red-700 dark:hover:bg-red-900/20">
                  Delete
                </button>
              </form>
            </div>

            <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">
              Added {{ offender.created_at|date:"M d, Y" }}
              {% if offender.updated_at != offender.created_at %} â€¢ Updated {{ offender.updated_at|date:"M d, Y" }}{% endif %}
            </p>
          </div>
        </div>
      {% empty %}
        <p class="col-span-full text-sm text-gray-500 dark:text-gray-400">No offenders found.</p>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="mt-6 flex items-center justify-center gap-2">
      {% if offenders.has_previous %}
        <a href="?page={{ offenders.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
           class="rounded border px-3 py-1 text-sm hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800">Previous</a>
      {% endif %}
      <span class="text-sm text-gray-600 dark:text-gray-300">
        Page {{ offenders.number }} / {{ offenders.paginator.num_pages }}
      </span>
      {% if offenders.has_next %}
        <a href="?page={{ offenders.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
           class="rounded border px-3 py-1 text-sm hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800">Next</a>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
